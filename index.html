
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Three Whys Value Proposition Assessor — SalesSparx</title>
  <style>
    :root{
      --brand-black:#000000;
      --brand-white:#ffffff;
      --brand-teal:#4CA09A;
      --brand-darkteal:#147E76;
      --brand-red:#CA2027;
      --gray-50:#f8f9fb;
      --gray-100:#f2f4f7;
      --gray-200:#e4e7ec;
      --gray-300:#d0d5dd;
      --gray-500:#667085;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial; color: var(--brand-black);background: var(--gray-50);line-height:1.5;}
    header{background: var(--brand-black);color: var(--brand-white);padding: 24px;display:flex;align-items:center;justify-content:space-between;}
    .logo{font-weight:800;letter-spacing:.5px;font-size:20px}
    .tag{font-size:12px;opacity:.9}
    main{max-width:980px;margin:24px auto;padding:0 16px 80px;}
    .card{background:var(--brand-white);border:1px solid var(--gray-200);border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.04);padding:24px;}
    h1{font-size:28px;margin:0 0 8px}
    h2{font-size:20px;margin:24px 0 8px}
    p.lead{color:var(--gray-500);margin:0 0 16px}
    label{display:block;margin:12px 0 6px;font-weight:600}
    input, textarea{width:100%;padding:12px 14px;border:1px solid var(--gray-300);border-radius:10px;background:var(--brand-white);font-size:14px;outline:none}
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .actions{margin-top:16px;display:flex;gap:12px}
    button{appearance:none;border:0;border-radius:999px;padding:12px 18px;font-weight:700;cursor:pointer}
    .btn-primary{background:var(--brand-teal);color:var(--brand-white)}
    .btn-secondary{background:var(--gray-100);color:var(--brand-black);border:1px solid var(--gray-300)}
    .pill{display:inline-flex;align-items:center;gap:8px;background:var(--brand-darkteal);color:#fff;padding:6px 10px;border-radius:999px;font-size:12px}
    .muted{color:var(--gray-500)}
    .hidden{display:none}
    .meter{height:10px;border-radius:999px;background:var(--gray-200);overflow:hidden;margin:8px 0 4px}
    .meter>span{display:block;height:100%;background:linear-gradient(90deg,var(--brand-teal),var(--brand-darkteal));width:0}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-4{grid-column:span 4}
    .col-8{grid-column:span 8}
    .badge{padding:4px 10px;border-radius:999px;border:1px solid var(--gray-300);background:var(--gray-100);font-size:12px}
    .callout{border-left:4px solid var(--brand-teal);background:#f2fcfb;padding:12px;border-radius:10px}
    ul{margin:8px 0 0 18px}
    .err{color:#b00020;font-weight:600}
  </style>
</head>
<body>
  <header>
    <div class="logo">sales<span style="color:#ffb100">SPARX</span></div>
    <div class="tag">Three Whys Value Proposition Assessor</div>
  </header>
  <main>
    <section id="page-identity" class="card">
      <h1>Start</h1>
      <p class="lead">This assessment benchmarks your value proposition across the Three Whys and returns role-tailored coaching.</p>
      <form id="id-form">
        <div class="row">
          <div><label>Name<input name="name" required></label></div>
          <div><label>Role<input name="role" required placeholder="CEO, CRO, Head of Product, etc."></label></div>
        </div>
        <div class="row">
          <div><label>Email<input name="email" type="email" required></label></div>
          <div><label>Organization<input name="organization" required></label></div>
        </div>
        <div class="actions">
          <button class="btn-primary" type="submit">Continue</button>
          <span class="muted">We do not store responses by default.</span>
        </div>
      </form>
    </section>

    <section id="page-assessment" class="card hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Assessment</h2>
        <span id="prof-pill" class="pill"></span>
      </div>
      <form id="tw-form">
        <label>Q1 — Who is the buyer and what is their top pain today? <span class="badge">Why change?</span></label>
        <textarea name="q1" maxlength="900" required></textarea>
        <label>Q2 — What trigger makes this a priority in the next 3–6 months? <span class="badge">Why now?</span></label>
        <textarea name="q2" maxlength="900" required></textarea>
        <label>Q3 — Why are you the right partner? Add 2–3 differentiators and one proof point. <span class="badge">Why your company?</span></label>
        <textarea name="q3" maxlength="900" required></textarea>
        <label>Q4 — Write a 1–2 line emotional hook headline.</label>
        <textarea name="q4" maxlength="900" required></textarea>
        <label>Q5 — Quantify expected outcomes and assumptions.</label>
        <textarea name="q5" maxlength="900" required></textarea>
        <label>Q6 — Draft a one-sentence value proposition.</label>
        <textarea name="q6" maxlength="900" required></textarea>

        <div class="actions">
          <button class="btn-primary" type="submit">Assess</button>
          <button class="btn-secondary" type="button" id="back">Back</button>
        </div>
      </form>
    </section>

    <section id="page-results" class="card hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Results</h2>
        <span id="band" class="pill"></span>
      </div>
      <div class="meter" aria-label="score meter"><span id="meter"></span></div>
      <p class="muted" id="scoreline"></p>

      <div class="grid">
        <div class="col-4">
          <h3>Scores by Dimension</h3>
          <div id="dim-list"></div>
        </div>
        <div class="col-8">
          <h3>Role-tailored Coaching</h3>
          <div id="coach" class="callout"></div>
          <h3>Suggested Final Value Proposition</h3>
          <div id="fvp" class="callout"></div>
          <h3>Next Actions</h3>
          <ul id="next"></ul>
        </div>
      </div>

      <div class="actions" style="margin-top:16px">
        <button id="restart" class="btn-primary" type="button">Run Again</button>
      </div>
      <p id="err" class="err"></p>
    </section>
  </main>

  <script>
    const idPage = document.getElementById('page-identity');
    const assessPage = document.getElementById('page-assessment');
    const resultsPage = document.getElementById('page-results');
    const idForm = document.getElementById('id-form');
    const assessForm = document.getElementById('tw-form');
    const backBtn = document.getElementById('back');
    const profPill = document.getElementById('prof-pill');
    const band = document.getElementById('band');
    const meter = document.getElementById('meter');
    const scoreline = document.getElementById('scoreline');
    const dimList = document.getElementById('dim-list');
    const coach = document.getElementById('coach');
    const fvp = document.getElementById('fvp');
    const next = document.getElementById('next');
    const err = document.getElementById('err');
    let profile = {};

    idForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      profile = Object.fromEntries(new FormData(idForm).entries());
      profPill.textContent = `${profile.name} • ${profile.role} @ ${profile.organization}`;
      idPage.classList.add('hidden');
      assessPage.classList.remove('hidden');
    });

    backBtn.addEventListener('click', ()=>{
      assessPage.classList.add('hidden');
      idPage.classList.remove('hidden');
    });

    assessForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      err.textContent = '';
      const answers = Object.fromEntries(new FormData(assessForm).entries());
      const payload = {profile, answers};
      let res;
      try{
        res = await fetch('/api/evaluate', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
      } catch(e){ /* ignore */ }

      let json;
      if(!res || !res.ok){
        json = demoResult(payload); // fallback
        err.textContent = 'Running demo mode. Confirm /api/evaluate is deployed and OPENAI_API_KEY is set.';
      } else {
        json = await res.json();
      }
      renderResult(json);
    });

    function renderResult(json){
      const total = json.total || 0;
      const max = 30;
      meter.style.width = Math.min(100, Math.round((total/max)*100)) + '%';
      band.textContent = json.band || '—';
      scoreline.textContent = `Total ${total} / ${max}`;

      dimList.innerHTML = (json.dimensions || []).map(d => `
        <div class="callout" style="margin:8px 0">
          <div><strong>${d.name}</strong></div>
          <div class="muted">Score: ${d.score} • Level: ${d.level || ''}</div>
          <div>${d.rationale || ''}</div>
        </div>
      `).join('');

      const c = json.coaching || {};
      coach.innerHTML = `
        <div><strong>Headline:</strong> ${c.headline_edit || ''}</div>
        <div><strong>Urgency:</strong> ${c.urgency_tightening || ''}</div>
        <div><strong>Differentiators:</strong> ${c.differentiator_rewrite || ''}</div>
        <div><strong>Value Calc Outline:</strong> ${(c.value_calc_outline||[]).join(' • ')}</div>
      `;
      fvp.textContent = c.final_value_prop || '';
      next.innerHTML = (c.next_actions || []).map(x=>`<li>${x}</li>`).join('');

      assessPage.classList.add('hidden');
      resultsPage.classList.remove('hidden');

      document.getElementById('restart').onclick = ()=>{
        resultsPage.classList.add('hidden');
        assessForm.reset();
        assessPage.classList.remove('hidden');
      };
    }

    function demoResult(payload){
      const dims = [
        {name:'Why change'}, {name:'Why now'}, {name:'Why your company'},
        {name:'Emotion→Logic'},{name:'Buyer-as-hero'},{name:'Clarity'}
      ].map(d=>({name:d.name, score:3, level:'Basic', rationale:'Demo score. Connect emotion to quantified outcomes.', evidence: [] }));
      const total = dims.reduce((a,b)=>a+b.score,0);
      const role = (payload.profile.role||'').toLowerCase();
      const CoachingByRole = role.includes('product') ? {
        headline_edit: 'Ship a message the whole org can use.',
        urgency_tightening: 'Tie roadmap items to revenue risk in the next two quarters.',
        differentiator_rewrite: 'Name a workflow you uniquely automate end-to-end.',
        final_value_prop: 'We unify product, marketing, and sales on a single value story that drives adoption and revenue.',
        value_calc_outline: ['Baseline activation','Lift assumption','Payback months'],
        next_actions: ['Gather 3 customer quotes','Document one-liner per ICP','Baseline activation metric']
      } : {
        headline_edit: 'Stop losing deals to faster storytellers.',
        urgency_tightening: 'Anchor to quarter-end or competitive deadlines.',
        differentiator_rewrite: 'Cite one unique proof with numbers.',
        final_value_prop: 'We align teams on a clear, quantified value story that accelerates pipeline and win rate.',
        value_calc_outline: ['Baseline win rate','Assumed delta','Impact range'],
        next_actions: ['Collect baseline metrics','Draft a 100-word case','Validate with 3 customers']
      };
      return { profile: payload.profile, total, band:'Basic', dimensions:dims, coaching:{role_adaptive:true, ...CoachingByRole}, risks:['Unsubstantiated ROI'], path:'A' };
    }
  </script>
</body>
</html>
